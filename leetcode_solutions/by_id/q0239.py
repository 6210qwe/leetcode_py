# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 239
标题: Sliding Window Maximum
难度: hard
链接: https://leetcode.cn/problems/sliding-window-maximum/
题目类型: 队列、数组、滑动窗口、单调队列、堆（优先队列）
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
239. 滑动窗口最大值 - 给你一个整数数组 nums，有一个大小为 k 的滑动窗口从数组的最左侧移动到数组的最右侧。你只可以看到在滑动窗口内的 k 个数字。滑动窗口每次只向右移动一位。 返回 滑动窗口中的最大值 。 示例 1： 输入：nums = [1,3,-1,-3,5,3,6,7], k = 3 输出：[3,3,5,5,6,7] 解释： 滑动窗口的位置 最大值 --------------- ----- [1 3 -1] -3 5 3 6 7 3 1 [3 -1 -3] 5 3 6 7 3 1 3 [-1 -3 5] 3 6 7 5 1 3 -1 [-3 5 3] 6 7 5 1 3 -1 -3 [5 3 6] 7 6 1 3 -1 -3 5 [3 6 7] 7 示例 2： 输入：nums = [1], k = 1 输出：[1] 提示： * 1 <= nums.length <= 105 * -104 <= nums[i] <= 104 * 1 <= k <= nums.length
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用单调递减双端队列，队列中存储索引，保持队列头部是当前窗口最大值的索引

算法步骤:
1. 使用双端队列存储索引，保持队列单调递减
2. 遍历数组，对于每个元素：
   - 移除队列中不在窗口内的索引
   - 移除队列尾部小于当前元素的索引
   - 将当前索引加入队列
   - 如果窗口大小达到k，记录队列头部的值

关键点:
- 使用单调队列维护窗口最大值
- 时间复杂度O(n)，空间复杂度O(k)
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n) - 每个元素最多入队和出队一次
空间复杂度: O(k) - 双端队列最多存储k个元素
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List
from collections import deque
from leetcode_solutions.utils.solution import create_solution


def sliding_window_maximum(nums: List[int], k: int) -> List[int]:
    """
    函数式接口 - 滑动窗口最大值
    
    实现思路:
    使用单调递减双端队列，队列中存储索引，保持队列头部是当前窗口最大值的索引。
    
    Args:
        nums: 整数数组
        k: 滑动窗口大小
        
    Returns:
        滑动窗口中的最大值数组
        
    Example:
        >>> sliding_window_maximum([1,3,-1,-3,5,3,6,7], 3)
        [3, 3, 5, 5, 6, 7]
    """
    dq = deque()
    result = []
    
    for i in range(len(nums)):
        # 移除不在窗口内的索引
        while dq and dq[0] <= i - k:
            dq.popleft()
        
        # 移除队列尾部小于当前元素的索引
        while dq and nums[dq[-1]] < nums[i]:
            dq.pop()
        
        dq.append(i)
        
        # 窗口大小达到k时，记录最大值
        if i >= k - 1:
            result.append(nums[dq[0]])
    
    return result


# 自动生成Solution类（无需手动编写）
Solution = create_solution(sliding_window_maximum)
