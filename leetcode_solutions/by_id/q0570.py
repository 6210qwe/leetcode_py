# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 570
标题: Managers with at Least 5 Direct Reports
难度: medium
链接: https://leetcode.cn/problems/managers-with-at-least-5-direct-reports/
题目类型: 数据库
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
570. 至少有5名直接下属的经理 - 表: Employee +-------------+---------+ | Column Name | Type | +-------------+---------+ | id | int | | name | varchar | | department | varchar | | managerId | int | +-------------+---------+ id 是此表的主键（具有唯一值的列）。 该表的每一行表示雇员的名字、他们的部门和他们的经理的id。 如果managerId为空，则该员工没有经理。 没有员工会成为自己的管理者。 编写一个解决方案，找出至少有五个直接下属的经理。 以 任意顺序 返回结果表。 查询结果格式如下所示。 示例 1: 输入: Employee 表: +-----+-------+------------+-----------+ | id | name | department | managerId | +-----+-------+------------+-----------+ | 101 | John | A | Null | | 102 | Dan | A | 101 | | 103 | James | A | 101 | | 104 | Amy | A | 101 | | 105 | Anne | A | 101 | | 106 | Ron | B | 101 | +-----+-------+------------+-----------+ 输出: +------+ | name | +------+ | John | +------+
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用Pandas库进行数据处理，通过groupby和count方法统计每个经理的直接下属数量，然后筛选出至少有五个直接下属的经理。

算法步骤:
1. 读取Employee表。
2. 使用groupby按managerId分组，并计算每个managerId的出现次数。
3. 筛选出直接下属数量大于等于5的managerId。
4. 通过这些managerId在原表中找到对应的经理名字。

关键点:
- 使用Pandas的groupby和count方法进行高效的数据处理。
- 确保筛选条件正确，避免遗漏或错误的经理。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)，其中n是Employee表的行数。因为我们需要遍历整个表来进行分组和计数操作。
空间复杂度: O(n)，因为我们需要存储分组后的数据和最终的结果。
"""

# ============================================================================
# 代码实现
# ============================================================================

import pandas as pd

def find_managers(employee: pd.DataFrame) -> pd.DataFrame:
    """
    找出至少有五个直接下属的经理。
    """
    # 统计每个经理的直接下属数量
    manager_counts = employee.groupby('managerId').size().reset_index(name='count')
    
    # 筛选出至少有五个直接下属的经理
    managers_with_five_or_more = manager_counts[manager_counts['count'] >= 5]['managerId']
    
    # 找到这些经理的名字
    result = employee[employee['id'].isin(managers_with_five_or_more)]['name'].to_frame()
    
    return result

Solution = create_solution(find_managers)