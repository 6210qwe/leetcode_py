# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 758
标题: Convert Binary Search Tree to Sorted Doubly Linked List
难度: medium
链接: https://leetcode.cn/problems/convert-binary-search-tree-to-sorted-doubly-linked-list/
题目类型: 栈、树、深度优先搜索、二叉搜索树、链表、二叉树、双向链表
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
426. 将二叉搜索树转化为排序的双向链表 - 备战技术面试？力扣提供海量技术面试资源，帮助你高效提升编程技能,轻松拿下世界 IT 名企 Dream Offer。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用中序遍历将二叉搜索树转换为排序的双向链表。

算法步骤:
1. 定义一个辅助函数 `inorder` 进行中序遍历。
2. 在中序遍历过程中，维护一个 `prev` 指针来连接前一个节点和当前节点。
3. 最后返回双向链表的头节点。

关键点:
- 中序遍历保证了节点按从小到大的顺序访问。
- 使用 `prev` 指针连接前一个节点和当前节点，形成双向链表。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)，其中 n 是树中节点的数量。每个节点只访问一次。
空间复杂度: O(h)，其中 h 是树的高度。递归调用栈的深度最多为树的高度。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import Optional

class Node:
    def __init__(self, val: int = 0, left: 'Node' = None, right: 'Node' = None):
        self.val = val
        self.left = left
        self.right = right

def tree_to_doubly_list(root: 'Node') -> 'Node':
    """
    将二叉搜索树转化为排序的双向链表
    """
    if not root:
        return None

    def inorder(node: 'Node'):
        nonlocal prev, head
        if node:
            inorder(node.left)
            
            if prev:
                prev.right = node
                node.left = prev
            else:
                head = node  # 记录头节点
            
            prev = node
            inorder(node.right)

    prev = None
    head = None
    inorder(root)
    
    # 连接头尾节点
    head.left = prev
    prev.right = head
    
    return head

Solution = create_solution(tree_to_doubly_list)