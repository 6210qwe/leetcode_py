# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 224
标题: Basic Calculator
难度: hard
链接: https://leetcode.cn/problems/basic-calculator/
题目类型: 栈、递归、数学、字符串
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
224. 基本计算器 - 给你一个字符串表达式 s ，请你实现一个基本计算器来计算并返回它的值。 注意:不允许使用任何将字符串作为数学表达式计算的内置函数，比如 eval() 。 示例 1： 输入：s = "1 + 1" 输出：2 示例 2： 输入：s = " 2-1 + 2 " 输出：3 示例 3： 输入：s = "(1+(4+5+2)-3)+(6+8)" 输出：23 提示： * 1 <= s.length <= 3 * 105 * s 由数字、'+'、'-'、'('、')'、和 ' ' 组成 * s 表示一个有效的表达式 * '+' 不能用作一元运算(例如， "+1" 和 "+(2 + 3)" 无效) * '-' 可以用作一元运算(即 "-1" 和 "-(2 + 3)" 是有效的) * 输入中不存在两个连续的操作符 * 每个数字和运行的计算将适合于一个有符号的 32位 整数
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用栈处理括号，维护当前符号和结果

算法步骤:
1. 使用栈存储遇到括号前的符号和结果
2. 遇到'('时，将当前结果和符号入栈
3. 遇到')'时，弹出栈顶的符号和结果
4. 遇到数字时，累加到当前结果
5. 遇到'+'或'-'时，更新符号

关键点:
- 使用栈处理括号嵌套
- 时间复杂度O(n)，空间复杂度O(n)
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n) - 需要遍历字符串一次
空间复杂度: O(n) - 栈的空间
"""

# ============================================================================
# 代码实现
# ============================================================================

from leetcode_solutions.utils.solution import create_solution


def basic_calculator(s: str) -> int:
    """
    函数式接口 - 基本计算器
    
    实现思路:
    使用栈处理括号，维护当前符号和结果。
    
    Args:
        s: 字符串表达式
        
    Returns:
        计算结果
        
    Example:
        >>> basic_calculator("1 + 1")
        2
    """
    stack = []
    result = 0
    sign = 1
    num = 0
    i = 0
    
    while i < len(s):
        char = s[i]
        
        if char.isdigit():
            # 读取完整数字
            num = 0
            while i < len(s) and s[i].isdigit():
                num = num * 10 + int(s[i])
                i += 1
            i -= 1
            result += sign * num
            num = 0
        elif char == '+':
            sign = 1
        elif char == '-':
            sign = -1
        elif char == '(':
            # 将当前结果和符号入栈
            stack.append(result)
            stack.append(sign)
            result = 0
            sign = 1
        elif char == ')':
            # 弹出符号和结果
            result *= stack.pop()  # 符号
            result += stack.pop()  # 之前的结果
        
        i += 1
    
    return result


# 自动生成Solution类（无需手动编写）
Solution = create_solution(basic_calculator)
