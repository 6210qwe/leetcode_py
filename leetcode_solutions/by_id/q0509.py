# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 509
标题: Inorder Successor in BST II
难度: medium
链接: https://leetcode.cn/problems/inorder-successor-in-bst-ii/
题目类型: 树、二叉搜索树、二叉树
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
510. 二叉搜索树中的中序后继 II - 备战技术面试？力扣提供海量技术面试资源，帮助你高效提升编程技能,轻松拿下世界 IT 名企 Dream Offer。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 利用二叉搜索树的性质，找到目标节点的中序后继。

算法步骤:
1. 如果目标节点有右子树，那么中序后继是其右子树的最左节点。
2. 如果目标节点没有右子树，那么从中序遍历的角度来看，中序后继是第一个从左向右遍历时遇到的目标节点的祖先节点。

关键点:
- 通过父指针可以快速找到祖先节点。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(H)，其中 H 是树的高度。在最坏情况下，树可能退化成链表，此时 H = N。
空间复杂度: O(1)，只使用了常数级的额外空间。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import Optional

class Node:
    def __init__(self, val: int = 0, left: 'Node' = None, right: 'Node' = None, parent: 'Node' = None):
        self.val = val
        self.left = left
        self.right = right
        self.parent = parent

def inorder_successor(node: 'Node') -> 'Optional[Node]':
    """
    找到给定节点的中序后继。
    """
    # 如果节点有右子树，那么中序后继是其右子树的最左节点
    if node.right:
        successor = node.right
        while successor.left:
            successor = successor.left
        return successor
    
    # 如果节点没有右子树，那么从中序遍历的角度来看，中序后继是第一个从左向右遍历时遇到的目标节点的祖先节点
    while node.parent and node == node.parent.right:
        node = node.parent
    return node.parent

Solution = create_solution(inorder_successor)