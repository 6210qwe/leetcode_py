# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 678
标题: Valid Parenthesis String
难度: medium
链接: https://leetcode.cn/problems/valid-parenthesis-string/
题目类型: 栈、贪心、字符串、动态规划
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
678. 有效的括号字符串 - 给你一个只包含三种字符的字符串，支持的字符类型分别是 '('、')' 和 '*'。请你检验这个字符串是否为有效字符串，如果是 有效 字符串返回 true 。 有效 字符串符合如下规则： * 任何左括号 '(' 必须有相应的右括号 ')'。 * 任何右括号 ')' 必须有相应的左括号 '(' 。 * 左括号 '(' 必须在对应的右括号之前 ')'。 * '*' 可以被视为单个右括号 ')' ，或单个左括号 '(' ，或一个空字符串 ""。 示例 1： 输入：s = "()" 输出：true 示例 2： 输入：s = "(*)" 输出：true 示例 3： 输入：s = "(*))" 输出：true 提示： * 1 <= s.length <= 100 * s[i] 为 '('、')' 或 '*'
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 贪心维护可能的左括号数量区间 [low, high]

算法步骤:
1. 定义两个变量：
   - low: 在将 '*' 视为 ')' 或空串 时，可能的最小未匹配 '(' 数量
   - high: 在将 '*' 视为 '(' 时，可能的最大未匹配 '(' 数量
2. 遍历字符串 s：
   - 若为 '('：low += 1, high += 1
   - 若为 ')'：low -= 1, high -= 1
   - 若为 '*'：low -= 1, high += 1（因为 '*' 可以当作 '(', ')' 或空）
3. 每一步将 low 约束为不小于 0（因为未匹配左括号数量不能为负），即 low = max(low, 0)
4. 若某一步 high < 0，说明无论如何选择 '*'，右括号都太多，返回 False
5. 遍历结束后，若 low == 0，则说明存在一种选择方式使括号完全匹配，返回 True

关键点:
- low 和 high 只是“可能范围”，不是精确计数
- high < 0 时可以立即判定无解
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n) - 只遍历一次字符串
空间复杂度: O(1) - 只使用常数空间
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List, Optional
from leetcode_solutions.utils.linked_list import ListNode
from leetcode_solutions.utils.tree import TreeNode
from leetcode_solutions.utils.solution import create_solution


def check_valid_string(s: str) -> bool:
    """
    函数式接口 - 有效的括号字符串
    """
    low = 0   # 可能的最小未匹配 '(' 数量
    high = 0  # 可能的最大未匹配 '(' 数量

    for ch in s:
        if ch == '(':
            low += 1
            high += 1
        elif ch == ')':
            low -= 1
            high -= 1
        else:  # '*'
            low -= 1
            high += 1

        if high < 0:
            return False
        if low < 0:
            low = 0

    return low == 0


Solution = create_solution(check_valid_string)
