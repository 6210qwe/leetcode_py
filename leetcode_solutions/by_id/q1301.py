# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 1301
标题: Reformat Department Table
难度: easy
链接: https://leetcode.cn/problems/reformat-department-table/
题目类型: 数据库
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
1179. 重新格式化部门表 - 表 Department： +---------------+---------+ | Column Name | Type | +---------------+---------+ | id | int | | revenue | int | | month | varchar | +---------------+---------+ 在 SQL 中，(id, month) 是表的联合主键。 这个表格有关于每个部门每月收入的信息。 月份（month）可以取下列值 ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]。 重新格式化表格，使得 每个月 都有一个部门 id 列和一个收入列。 以 任意顺序 返回结果表。 结果格式如以下示例所示。 示例 1： 输入： Department table: +------+---------+-------+ | id | revenue | month | +------+---------+-------+ | 1 | 8000 | Jan | | 2 | 9000 | Jan | | 3 | 10000 | Feb | | 1 | 7000 | Feb | | 1 | 6000 | Mar | +------+---------+-------+ 输出： +------+-------------+-------------+-------------+-----+-------------+ | id | Jan_Revenue | Feb_Revenue | Mar_Revenue | ... | Dec_Revenue | +------+-------------+-------------+-------------+-----+-------------+ | 1 | 8000 | 7000 | 6000 | ... | null | | 2 | 9000 | null | null | ... | null | | 3 | null | 10000 | null | ... | null | +------+-------------+-------------+-------------+-----+-------------+ 解释：四月到十二月的收入为空。 请注意，结果表共有 13 列（1 列用于部门 ID，其余 12 列用于各个月份）。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用 Pandas 库来处理数据，通过 pivot_table 方法将数据重新格式化。

算法步骤:
1. 读取输入数据并转换为 Pandas DataFrame。
2. 使用 pivot_table 方法将数据重新格式化，使得每个月都有一个收入列。
3. 重命名列名，使其符合输出要求。
4. 将结果转换回所需的格式。

关键点:
- 使用 Pandas 的 pivot_table 方法进行数据重塑。
- 确保结果表的列名符合题目要求。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)，其中 n 是输入数据的行数。Pandas 的 pivot_table 操作的时间复杂度是线性的。
空间复杂度: O(n)，需要存储整个 DataFrame。
"""

# ============================================================================
# 代码实现
# ============================================================================

import pandas as pd

def reformat_department_table(department: List[List[str]]) -> pd.DataFrame:
    """
    重新格式化部门表，使得每个月都有一个收入列。
    """
    # 将输入数据转换为 DataFrame
    df = pd.DataFrame(department, columns=['id', 'revenue', 'month'])
    
    # 使用 pivot_table 方法将数据重新格式化
    df_pivot = df.pivot_table(index='id', columns='month', values='revenue', aggfunc='sum').reset_index()
    
    # 重命名列名
    df_pivot.columns.name = None
    df_pivot.columns = ['id'] + [f'{col}_Revenue' for col in df_pivot.columns[1:]]
    
    # 填充缺失值
    df_pivot = df_pivot.fillna(None)
    
    return df_pivot

# 示例数据
department = [
    [1, 8000, 'Jan'],
    [2, 9000, 'Jan'],
    [3, 10000, 'Feb'],
    [1, 7000, 'Feb'],
    [1, 6000, 'Mar']
]

# 调用函数
result = reformat_department_table(department)
print(result)

# ============================================================================
# 工厂函数
# ============================================================================
from leetcode_solutions.utils.solution import create_solution

Solution = create_solution(reformat_department_table)