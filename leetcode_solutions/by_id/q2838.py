# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 2838
标题: Sum of Matrix After Queries
难度: medium
链接: https://leetcode.cn/problems/sum-of-matrix-after-queries/
题目类型: 数组、哈希表
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
2718. 查询后矩阵的和 - 给你一个整数 n 和一个下标从 0 开始的 二维数组 queries ，其中 queries[i] = [typei, indexi, vali] 。 一开始，给你一个下标从 0 开始的 n x n 矩阵，所有元素均为 0 。每一个查询，你需要执行以下操作之一： * 如果 typei == 0 ，将第 indexi 行的元素全部修改为 vali ，覆盖任何之前的值。 * 如果 typei == 1 ，将第 indexi 列的元素全部修改为 vali ，覆盖任何之前的值。 请你执行完所有查询以后，返回矩阵中所有整数的和。 示例 1： [https://assets.leetcode.com/uploads/2023/05/11/exm1.png] 输入：n = 3, queries = [[0,0,1],[1,2,2],[0,2,3],[1,0,4]] 输出：23 解释：上图展示了每个查询以后矩阵的值。所有操作执行完以后，矩阵元素之和为 23 。 示例 2： [https://assets.leetcode.com/uploads/2023/05/11/exm2.png] 输入：n = 3, queries = [[0,0,4],[0,1,2],[1,0,1],[0,2,3],[1,2,1]] 输出：17 解释：上图展示了每一个查询操作之后的矩阵。所有操作执行完以后，矩阵元素之和为 17 。 提示： * 1 <= n <= 104 * 1 <= queries.length <= 5 * 104 * queries[i].length == 3 * 0 <= typei <= 1 * 0 <= indexi < n * 0 <= vali <= 105
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 通过逆序处理查询来避免重复计算，并使用集合来记录已经更新过的行和列。

算法步骤:
1. 初始化结果总和为 0。
2. 使用两个集合分别记录已经更新过的行和列。
3. 逆序遍历查询列表：
   - 对于每条查询，检查该行或列是否已经被更新过。
   - 如果没有被更新过，则根据查询类型更新总和，并将该行或列标记为已更新。
4. 返回最终的总和。

关键点:
- 逆序处理查询可以确保每次更新都是基于最新的状态。
- 使用集合来记录已经更新过的行和列，避免重复计算。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(q)，其中 q 是查询的数量。
空间复杂度: O(n)，用于存储已经更新过的行和列。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List

def sum_of_matrix_after_queries(n: int, queries: List[List[int]]) -> int:
    """
    函数式接口 - 计算执行完所有查询后的矩阵元素之和
    """
    # 初始化结果总和
    total_sum = 0
    # 使用集合记录已经更新过的行和列
    updated_rows = set()
    updated_cols = set()

    # 逆序遍历查询列表
    for query in reversed(queries):
        query_type, index, value = query
        if query_type == 0:  # 更新行
            if index not in updated_rows:
                total_sum += value * (n - len(updated_cols))
                updated_rows.add(index)
        else:  # 更新列
            if index not in updated_cols:
                total_sum += value * (n - len(updated_rows))
                updated_cols.add(index)

    return total_sum

Solution = create_solution(sum_of_matrix_after_queries)