# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 438
标题: Find All Anagrams in a String
难度: medium
链接: https://leetcode.cn/problems/find-all-anagrams-in-a-string/
题目类型: 哈希表、字符串、滑动窗口
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
438. 找到字符串中所有字母异位词 - 给定两个字符串 s 和 p，找到 s 中所有 p 的 异位词 的子串，返回这些子串的起始索引。不考虑答案输出的顺序。 示例 1: 输入: s = "cbaebabacd", p = "abc" 输出: [0,6] 解释: 起始索引等于 0 的子串是 "cba", 它是 "abc" 的异位词。 起始索引等于 6 的子串是 "bac", 它是 "abc" 的异位词。 示例 2: 输入: s = "abab", p = "ab" 输出: [0,1,2] 解释: 起始索引等于 0 的子串是 "ab", 它是 "ab" 的异位词。 起始索引等于 1 的子串是 "ba", 它是 "ab" 的异位词。 起始索引等于 2 的子串是 "ab", 它是 "ab" 的异位词。 提示: * 1 <= s.length, p.length <= 3 * 104 * s 和 p 仅包含小写字母
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用滑动窗口和哈希表来解决这个问题

算法步骤:
1. 初始化两个哈希表，一个用于记录 p 中字符的频率，另一个用于记录当前窗口中字符的频率。
2. 使用滑动窗口遍历字符串 s，窗口大小为 p 的长度。
3. 在每次滑动时，更新窗口中的字符频率，并检查是否与 p 的字符频率匹配。
4. 如果匹配，则将当前窗口的起始索引加入结果列表。

关键点:
- 使用滑动窗口可以避免重复计算，提高效率。
- 通过哈希表记录字符频率，可以快速判断当前窗口是否为 p 的异位词。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n) - n 是字符串 s 的长度，因为每个字符最多被处理两次（一次加入窗口，一次移出窗口）。
空间复杂度: O(1) - 哈希表的大小最多为 26（小写字母的数量），因此空间复杂度为常数级。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List

def find_all_anagrams_in_a_string(s: str, p: str) -> List[int]:
    """
    函数式接口 - 找到字符串 s 中所有 p 的异位词的起始索引
    
    实现思路:
    使用滑动窗口和哈希表来解决这个问题。通过滑动窗口遍历字符串 s，窗口大小为 p 的长度，并使用哈希表记录字符频率，快速判断当前窗口是否为 p 的异位词。
    
    Args:
        s (str): 主字符串
        p (str): 模式字符串
        
    Returns:
        List[int]: 返回所有 p 的异位词在 s 中的起始索引
        
    Example:
        >>> find_all_anagrams_in_a_string("cbaebabacd", "abc")
        [0, 6]
    """
    if len(p) > len(s):
        return []

    p_count = [0] * 26
    s_count = [0] * 26
    result = []

    for i in range(len(p)):
        p_count[ord(p[i]) - ord('a')] += 1
        s_count[ord(s[i]) - ord('a')] += 1

    if p_count == s_count:
        result.append(0)

    for i in range(len(p), len(s)):
        s_count[ord(s[i]) - ord('a')] += 1
        s_count[ord(s[i - len(p)]) - ord('a')] -= 1
        if s_count == p_count:
            result.append(i - len(p) + 1)

    return result


# 自动生成Solution类（无需手动编写）
Solution = create_solution(find_all_anagrams_in_a_string)