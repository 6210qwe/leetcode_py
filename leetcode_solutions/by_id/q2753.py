# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 2753
标题: Minimum Number of Operations to Make All Array Elements Equal to 1
难度: medium
链接: https://leetcode.cn/problems/minimum-number-of-operations-to-make-all-array-elements-equal-to-1/
题目类型: 数组、数学、数论
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
2654. 使数组所有元素变成 1 的最少操作次数 - 给你一个下标从 0 开始的 正 整数数组 nums 。你可以对数组执行以下操作 任意 次： * 选择一个满足 0 <= i < n - 1 的下标 i ，将 nums[i] 或者 nums[i+1] 两者之一替换成它们的最大公约数。 请你返回使数组 nums 中所有元素都等于 1 的 最少 操作次数。如果无法让数组全部变成 1 ，请你返回 -1 。 两个正整数的最大公约数指的是能整除这两个数的最大正整数。 示例 1： 输入：nums = [2,6,3,4] 输出：4 解释：我们可以执行以下操作： - 选择下标 i = 2 ，将 nums[2] 替换为 gcd(3,4) = 1 ，得到 nums = [2,6,1,4] 。 - 选择下标 i = 1 ，将 nums[1] 替换为 gcd(6,1) = 1 ，得到 nums = [2,1,1,4] 。 - 选择下标 i = 0 ，将 nums[0] 替换为 gcd(2,1) = 1 ，得到 nums = [1,1,1,4] 。 - 选择下标 i = 2 ，将 nums[3] 替换为 gcd(1,4) = 1 ，得到 nums = [1,1,1,1] 。 示例 2： 输入：nums = [2,10,6,14] 输出：-1 解释：无法将所有元素都变成 1 。 提示： * 2 <= nums.length <= 50 * 1 <= nums[i] <= 106
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 通过计算数组中所有元素的最大公约数，来判断是否可以将所有元素变为 1。如果最大公约数为 1，则可以通过一系列操作将所有元素变为 1。

算法步骤:
1. 计算数组中所有元素的最大公约数。
2. 如果最大公约数不为 1，返回 -1。
3. 如果最大公约数为 1，计算将所有元素变为 1 所需的最少操作次数。

关键点:
- 使用 Python 的 math.gcd 函数来计算最大公约数。
- 通过遍历数组，找到第一个为 1 的元素，然后计算将其传播到整个数组所需的最少操作次数。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n log(max(nums))) - 计算最大公约数的时间复杂度为 O(log(max(nums)))，遍历数组的时间复杂度为 O(n)。
空间复杂度: O(1) - 只使用了常数级的额外空间。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List
import math
from leetcode_solutions.utils.solution import create_solution

def min_operations_to_one(nums: List[int]) -> int:
    """
    使数组所有元素变成 1 的最少操作次数
    """
    # 计算数组中所有元素的最大公约数
    gcd = nums[0]
    for num in nums[1:]:
        gcd = math.gcd(gcd, num)
    
    # 如果最大公约数不为 1，返回 -1
    if gcd != 1:
        return -1
    
    # 计算将所有元素变为 1 所需的最少操作次数
    first_one_index = -1
    for i, num in enumerate(nums):
        if num == 1:
            first_one_index = i
            break
    
    if first_one_index == -1:
        # 如果没有 1，需要先生成一个 1
        return len(nums) - 1 + (len(nums) - 2)
    else:
        # 已经有一个 1，计算将其传播到整个数组所需的最少操作次数
        return len(nums) - 1

Solution = create_solution(min_operations_to_one)