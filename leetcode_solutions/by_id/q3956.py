# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 3956
标题: Trionic Array II
难度: hard
链接: https://leetcode.cn/problems/trionic-array-ii/
题目类型: 数组、动态规划
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
3640. 三段式数组 II - 给你一个长度为 n 的整数数组 nums。 三段式子数组 是一个连续子数组 nums[l...r]（满足 0 <= l < r < n），并且存在下标 l < p < q < r，使得： * nums[l...p] 严格 递增， * nums[p...q] 严格 递减， * nums[q...r] 严格 递增。 请你从数组 nums 的所有三段式子数组中找出和最大的那个，并返回其 最大 和。 示例 1： 输入：nums = [0,-2,-1,-3,0,2,-1] 输出：-4 解释： 选择 l = 1, p = 2, q = 3, r = 5： * nums[l...p] = nums[1...2] = [-2, -1] 严格递增 (-2 < -1)。 * nums[p...q] = nums[2...3] = [-1, -3] 严格递减 (-1 > -3)。 * nums[q...r] = nums[3...5] = [-3, 0, 2] 严格递增 (-3 < 0 < 2)。 * 和 = (-2) + (-1) + (-3) + 0 + 2 = -4。 示例 2: 输入: nums = [1,4,2,7] 输出: 14 解释: 选择 l = 0, p = 1, q = 2, r = 3： * nums[l...p] = nums[0...1] = [1, 4] 严格递增 (1 < 4)。 * nums[p...q] = nums[1...2] = [4, 2] 严格递减 (4 > 2)。 * nums[q...r] = nums[2...3] = [2, 7] 严格递增 (2 < 7)。 * 和 = 1 + 4 + 2 + 7 = 14。 提示: * 4 <= n = nums.length <= 105 * -109 <= nums[i] <= 109 * 保证至少存在一个三段式子数组。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用动态规划来记录每个位置的最大和。

算法步骤:
1. 初始化两个数组 `inc` 和 `dec`，分别记录以当前元素结尾的严格递增子数组和严格递减子数组的最大和。
2. 遍历数组，更新 `inc` 和 `dec` 数组。
3. 再次遍历数组，计算每个可能的三段式子数组的最大和。

关键点:
- 动态规划的思想，通过前缀和来优化计算。
- 两次遍历数组，一次用于更新 `inc` 和 `dec` 数组，另一次用于计算最大和。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)
空间复杂度: O(n)
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List, Optional
from leetcode_solutions.utils.linked_list import ListNode
from leetcode_solutions.utils.tree import TreeNode
from leetcode_solutions.utils.solution import create_solution


def max_trionic_sum(nums: List[int]) -> int:
    """
    计算给定数组中的最大三段式子数组和。
    """
    n = len(nums)
    inc = [0] * n  # 以当前元素结尾的严格递增子数组的最大和
    dec = [0] * n  # 以当前元素结尾的严格递减子数组的最大和
    
    # 初始化第一个元素
    inc[0] = nums[0]
    dec[0] = nums[0]
    
    # 更新 inc 和 dec 数组
    for i in range(1, n):
        if nums[i] > nums[i - 1]:
            inc[i] = inc[i - 1] + nums[i]
            dec[i] = nums[i]
        elif nums[i] < nums[i - 1]:
            dec[i] = dec[i - 1] + nums[i]
            inc[i] = nums[i]
        else:
            inc[i] = nums[i]
            dec[i] = nums[i]
    
    max_sum = float('-inf')
    
    # 计算最大三段式子数组和
    for i in range(2, n):
        for j in range(1, i):
            if nums[j] > nums[j - 1] and nums[j] > nums[i]:
                current_sum = inc[j - 1] + dec[i] - dec[j] + inc[i]
                max_sum = max(max_sum, current_sum)
    
    return max_sum


Solution = create_solution(max_trionic_sum)