# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 1892
标题: Find Total Time Spent by Each Employee
难度: easy
链接: https://leetcode.cn/problems/find-total-time-spent-by-each-employee/
题目类型: 数据库
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
1741. 查找每个员工花费的总时间 - 表: Employees +-------------+------+ | Column Name | Type | +-------------+------+ | emp_id | int | | event_day | date | | in_time | int | | out_time | int | +-------------+------+ 在 SQL 中，(emp_id, event_day, in_time) 是这个表的主键。 该表显示了员工在办公室的出入情况。 event_day 是此事件发生的日期，in_time 是员工进入办公室的时间，而 out_time 是他们离开办公室的时间。 in_time 和 out_time 的取值在1到1440之间。 题目保证同一天没有两个事件在时间上是相交的，并且保证 in_time 小于 out_time。 计算每位员工每天在办公室花费的总时间（以分钟为单位）。 请注意，在一天之内，同一员工是可以多次进入和离开办公室的。 在办公室里一次进出所花费的时间为out_time 减去 in_time。 返回结果表单的顺序无要求。 查询结果的格式如下： 示例 1： 输入： Employees table: +--------+------------+---------+----------+ | emp_id | event_day | in_time | out_time | +--------+------------+---------+----------+ | 1 | 2020-11-28 | 4 | 32 | | 1 | 2020-11-28 | 55 | 200 | | 1 | 2020-12-03 | 1 | 42 | | 2 | 2020-11-28 | 3 | 33 | | 2 | 2020-12-09 | 47 | 74 | +--------+------------+---------+----------+ 输出： +------------+--------+------------+ | day | emp_id | total_time | +------------+--------+------------+ | 2020-11-28 | 1 | 173 | | 2020-11-28 | 2 | 30 | | 2020-12-03 | 1 | 41 | | 2020-12-09 | 2 | 27 | +------------+--------+------------+ 解释： 雇员 1 有三次进出: 有两次发生在 2020-11-28 花费的时间为 (32 - 4) + (200 - 55) = 173, 有一次发生在 2020-12-03 花费的时间为 (42 - 1) = 41。 雇员 2 有两次进出: 有一次发生在 2020-11-28 花费的时间为 (33 - 3) = 30, 有一次发生在 2020-12-09 花费的时间为 (74 - 47) = 27。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用Pandas库进行数据处理，计算每个员工每天的总时间。

算法步骤:
1. 读取输入数据并转换为Pandas DataFrame。
2. 计算每次进出的时间差。
3. 按日期和员工ID分组，计算每天的总时间。
4. 重命名列并返回结果。

关键点:
- 使用Pandas的groupby和agg函数进行高效的数据处理。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)，其中n是输入数据的行数。
空间复杂度: O(n)，用于存储中间结果。
"""

# ============================================================================
# 代码实现
# ============================================================================

import pandas as pd


def solution_function_name(employees: pd.DataFrame) -> pd.DataFrame:
    """
    函数式接口 - 计算每位员工每天在办公室花费的总时间
    """
    # 计算每次进出的时间差
    employees['total_time'] = employees['out_time'] - employees['in_time']
    
    # 按日期和员工ID分组，计算每天的总时间
    result = employees.groupby(['event_day', 'emp_id'])['total_time'].sum().reset_index()
    
    # 重命名列
    result = result.rename(columns={'event_day': 'day'})
    
    return result


Solution = create_solution(solution_function_name)