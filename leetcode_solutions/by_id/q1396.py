# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 1396
标题: Count Servers that Communicate
难度: medium
链接: https://leetcode.cn/problems/count-servers-that-communicate/
题目类型: 深度优先搜索、广度优先搜索、并查集、数组、计数、矩阵
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
1267. 统计参与通信的服务器 - 这里有一幅服务器分布图，服务器的位置标识在 m * n 的整数矩阵网格 grid 中，1 表示单元格上有服务器，0 表示没有。 如果两台服务器位于同一行或者同一列，我们就认为它们之间可以进行通信。 请你统计并返回能够与至少一台其他服务器进行通信的服务器的数量。 示例 1： [https://assets.leetcode.cn/aliyun-lc-upload/uploads/2019/11/24/untitled-diagram-6.jpg] 输入：grid = [[1,0],[0,1]] 输出：0 解释：没有一台服务器能与其他服务器进行通信。 示例 2： [https://assets.leetcode.cn/aliyun-lc-upload/uploads/2019/11/24/untitled-diagram-4-1.jpg] 输入：grid = [[1,0],[1,1]] 输出：3 解释：所有这些服务器都至少可以与一台别的服务器进行通信。 示例 3： [https://assets.leetcode.cn/aliyun-lc-upload/uploads/2019/11/24/untitled-diagram-1-3.jpg] 输入：grid = [[1,1,0,0],[0,0,1,0],[0,0,1,0],[0,0,0,1]] 输出：4 解释：第一行的两台服务器互相通信，第三列的两台服务器互相通信，但右下角的服务器无法与其他服务器通信。 提示： * m == grid.length * n == grid[i].length * 1 <= m <= 250 * 1 <= n <= 250 * grid[i][j] == 0 or 1
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用两个计数器分别记录每一行和每一列中服务器的数量。然后遍历整个网格，对于每个服务器，如果它所在的行或列中有超过一个服务器，则该服务器可以与其他服务器通信。

算法步骤:
1. 初始化两个计数器 `row_count` 和 `col_count`，分别记录每一行和每一列中服务器的数量。
2. 遍历整个网格，更新 `row_count` 和 `col_count`。
3. 再次遍历整个网格，对于每个服务器，检查其所在行或列中的服务器数量是否大于1，如果是，则将该服务器计入结果。

关键点:
- 使用两个计数器来记录每一行和每一列中服务器的数量，避免了多次遍历。
- 只需要两次遍历网格即可完成计算。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(m * n)，其中 m 是网格的行数，n 是网格的列数。我们需要遍历网格两次。
空间复杂度: O(m + n)，用于存储每一行和每一列中服务器的数量。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List

def count_servers(grid: List[List[int]]) -> int:
    """
    函数式接口 - 统计能够与至少一台其他服务器进行通信的服务器的数量
    """
    if not grid or not grid[0]:
        return 0

    m, n = len(grid), len(grid[0])
    row_count = [0] * m
    col_count = [0] * n

    # 计算每一行和每一列中服务器的数量
    for i in range(m):
        for j in range(n):
            if grid[i][j] == 1:
                row_count[i] += 1
                col_count[j] += 1

    # 统计能够与至少一台其他服务器进行通信的服务器的数量
    result = 0
    for i in range(m):
        for j in range(n):
            if grid[i][j] == 1 and (row_count[i] > 1 or col_count[j] > 1):
                result += 1

    return result

Solution = create_solution(count_servers)