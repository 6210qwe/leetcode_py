# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 1245
标题: User Activity for the Past 30 Days I
难度: easy
链接: https://leetcode.cn/problems/user-activity-for-the-past-30-days-i/
题目类型: 数据库
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
1141. 查询近30天活跃用户数 - 表：Activity +---------------+---------+ | Column Name | Type | +---------------+---------+ | user_id | int | | session_id | int | | activity_date | date | | activity_type | enum | +---------------+---------+ 该表可能包含重复数据。 activity_type 列是 ENUM(category) 类型， 从 ('open_session'， 'end_session'， 'scroll_down'， 'send_message') 取值。 该表记录社交媒体网站的用户活动。 注意，每个会话只属于一个用户。 编写解决方案，统计截至 2019-07-27（包含2019-07-27），近 30 天的每日活跃用户数（当天只要有一条活动记录，即为活跃用户）。 以 任意顺序 返回结果表。 结果示例如下。 注意：（'open_session'，'end_session'，'scroll_down'，'send_message'）中的任何活动将被视为用户在某一天活跃的有效活动。 示例 1: 输入： Activity table: +---------+------------+---------------+---------------+ | user_id | session_id | activity_date | activity_type | +---------+------------+---------------+---------------+ | 1 | 1 | 2019-07-20 | open_session | | 1 | 1 | 2019-07-20 | scroll_down | | 1 | 1 | 2019-07-20 | end_session | | 2 | 4 | 2019-07-20 | open_session | | 2 | 4 | 2019-07-21 | send_message | | 2 | 4 | 2019-07-21 | end_session | | 3 | 2 | 2019-07-21 | open_session | | 3 | 2 | 2019-07-21 | send_message | | 3 | 2 | 2019-07-21 | end_session | | 4 | 3 | 2019-06-25 | open_session | | 4 | 3 | 2019-06-25 | end_session | +---------+------------+---------------+---------------+ 输出： +------------+--------------+ | day | active_users | +------------+--------------+ | 2019-07-20 | 2 | | 2019-07-21 | 2 | +------------+--------------+ 解释：注意非活跃用户的记录不需要展示。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用Pandas进行数据处理，筛选出近30天的数据，并统计每天的活跃用户数。

算法步骤:
1. 读取Activity表数据。
2. 筛选出日期在2019-06-28到2019-07-27之间的数据。
3. 去重，确保每个用户在同一天只计一次。
4. 按日期分组，统计每天的活跃用户数。
5. 返回结果。

关键点:
- 使用Pandas进行高效的数据处理。
- 确保每个用户在同一天只计一次。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)，其中n是Activity表的行数。需要遍历整个表进行筛选和去重。
空间复杂度: O(n)，使用Pandas进行数据处理时，需要存储筛选后的数据。
"""

# ============================================================================
# 代码实现
# ============================================================================

import pandas as pd


def solution(activity: pd.DataFrame) -> pd.DataFrame:
    """
    函数式接口 - 统计近30天的每日活跃用户数
    """
    # 筛选出日期在2019-06-28到2019-07-27之间的数据
    start_date = '2019-06-28'
    end_date = '2019-07-27'
    filtered_activity = activity[(activity['activity_date'] >= start_date) & (activity['activity_date'] <= end_date)]
    
    # 去重，确保每个用户在同一天只计一次
    unique_activity = filtered_activity.drop_duplicates(subset=['user_id', 'activity_date'])
    
    # 按日期分组，统计每天的活跃用户数
    daily_active_users = unique_activity.groupby('activity_date')['user_id'].count().reset_index()
    daily_active_users.columns = ['day', 'active_users']
    
    return daily_active_users


Solution = create_solution(solution)