# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 2080
标题: Check if Move is Legal
难度: medium
链接: https://leetcode.cn/problems/check-if-move-is-legal/
题目类型: 数组、枚举、矩阵
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
1958. 检查操作是否合法 - 给你一个下标从 0 开始的 8 x 8 网格 board ，其中 board[r][c] 表示游戏棋盘上的格子 (r, c) 。棋盘上空格用 '.' 表示，白色格子用 'W' 表示，黑色格子用 'B' 表示。 游戏中每次操作步骤为：选择一个空格子，将它变成你正在执行的颜色（要么白色，要么黑色）。但是，合法 操作必须满足：涂色后这个格子是 好线段的一个端点 （好线段可以是水平的，竖直的或者是对角线）。 好线段 指的是一个包含 三个或者更多格子（包含端点格子）的线段，线段两个端点格子为 同一种颜色 ，且中间剩余格子的颜色都为 另一种颜色 （线段上不能有任何空格子）。你可以在下图找到好线段的例子： [https://assets.leetcode.com/uploads/2021/07/22/goodlines5.png] 给你两个整数 rMove 和 cMove 以及一个字符 color ，表示你正在执行操作的颜色（白或者黑），如果将格子 (rMove, cMove) 变成颜色 color 后，是一个 合法 操作，那么返回 true ，如果不是合法操作返回 false 。 示例 1： [https://assets.leetcode.com/uploads/2021/07/10/grid11.png] 输入：board = [[".",".",".","B",".",".",".","."],[".",".",".","W",".",".",".","."],[".",".",".","W",".",".",".","."],[".",".",".","W",".",".",".","."],["W","B","B",".","W","W","W","B"],[".",".",".","B",".",".",".","."],[".",".",".","B",".",".",".","."],[".",".",".","W",".",".",".","."]], rMove = 4, cMove = 3, color = "B" 输出：true 解释：'.'，'W' 和 'B' 分别用颜色蓝色，白色和黑色表示。格子 (rMove, cMove) 用 'X' 标记。 以选中格子为端点的两个好线段在上图中用红色矩形标注出来了。 示例 2： [https://assets.leetcode.com/uploads/2021/07/10/grid2.png] 输入：board = [[".",".",".",".",".",".",".","."],[".","B",".",".","W",".",".","."],[".",".","W",".",".",".",".","."],[".",".",".","W","B",".",".","."],[".",".",".",".",".",".",".","."],[".",".",".",".","B","W",".","."],[".",".",".",".",".",".","W","."],[".",".",".",".",".",".",".","B"]], rMove = 4, cMove = 4, color = "W" 输出：false 解释：虽然选中格子涂色后，棋盘上产生了好线段，但选中格子是作为中间格子，没有产生以选中格子为端点的好线段。 提示： * board.length == board[r].length == 8 * 0 <= rMove, cMove < 8 * board[rMove][cMove] == '.' * color 要么是 'B' 要么是 'W' 。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 通过检查八个方向（水平、垂直、对角线）来判断是否有好线段。

算法步骤:
1. 定义八个方向的移动向量。
2. 对于每个方向，从目标格子开始，沿着该方向移动，检查是否有连续的不同颜色的格子。
3. 如果遇到相同颜色的格子，则说明找到了一个好线段，返回 True。
4. 如果遍历完所有方向都没有找到好线段，返回 False。

关键点:
- 使用方向向量简化方向检查。
- 通过循环和条件判断来检查好线段。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(1) - 因为棋盘大小固定为 8x8，所以时间复杂度是常数级。
空间复杂度: O(1) - 只使用了常数级的额外空间。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List, Optional
from leetcode_solutions.utils.linked_list import ListNode
from leetcode_solutions.utils.tree import TreeNode
from leetcode_solutions.utils.solution import create_solution


def check_move(board: List[List[str]], r_move: int, c_move: int, color: str) -> bool:
    """
    检查操作是否合法
    """
    directions = [
        (0, 1), (1, 0), (0, -1), (-1, 0),
        (1, 1), (1, -1), (-1, -1), (-1, 1)
    ]
    opposite_color = 'B' if color == 'W' else 'W'

    def is_valid_line(r: int, c: int, dr: int, dc: int) -> bool:
        r, c = r + dr, c + dc
        count = 1
        while 0 <= r < 8 and 0 <= c < 8 and board[r][c] == opposite_color:
            r, c = r + dr, c + dc
            count += 1
        return 0 <= r < 8 and 0 <= c < 8 and board[r][c] == color and count >= 2

    for dr, dc in directions:
        if is_valid_line(r_move, c_move, dr, dc):
            return True
    return False


Solution = create_solution(check_move)