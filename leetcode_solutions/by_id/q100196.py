# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 100196
标题: Draw Line LCCI
难度: medium
链接: https://leetcode.cn/problems/draw-line-lcci/
题目类型: 位运算、数组、数学
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
面试题 05.08. 绘制直线 - 已知一个由像素点组成的单色屏幕，每行均有 w 个像素点，所有像素点初始为 0，左上角位置为 (0,0)。 现将每行的像素点按照「每 32 个像素点」为一组存放在一个 int 中，再依次存入长度为 length 的一维数组中。 我们将在屏幕上绘制一条从点 (x1,y) 到点 (x2,y) 的直线（即像素点修改为 1），请返回绘制过后的数组。 注意： * 用例保证屏幕宽度 w 可被 32 整除（即一个 int 不会分布在两行上） 示例 1： 输入：length = 1, w = 32, x1 = 30, x2 = 31, y = 0 输出：[3] 解释：在第 0 行的第 30 位到第 31 位画一条直线，屏幕二进制形式表示为 [00000000000000000000000000000011]，因此返回 [3] 示例 2： 输入：length = 3, w = 96, x1 = 0, x2 = 95, y = 0 输出：[-1, -1, -1] 解释：由于二进制 11111111111111111111111111111111 的 int 类型代表 -1，因此返回 [-1,-1,-1] 提示： * 1 <= length <= 10^5 * 1 <= w <= 3 * 10^5 * 0 <= x1 <= x2 < w * 0 <= y <= 10
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用位运算来设置指定位置的像素点。

算法步骤:
1. 计算出需要修改的整数索引范围。
2. 对于每个整数，使用位运算设置对应的像素点。

关键点:
- 每 32 个像素点为一个整数，计算出需要修改的整数索引范围。
- 使用位运算设置指定位置的像素点。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(1) - 因为最多修改 32 个整数，所以时间复杂度是常数级。
空间复杂度: O(1) - 只使用了常数级的额外空间。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List, Optional
from leetcode_solutions.utils.linked_list import ListNode
from leetcode_solutions.utils.tree import TreeNode
from leetcode_solutions.utils.solution import create_solution


def draw_line(length: int, w: int, x1: int, x2: int, y: int) -> List[int]:
    """
    在屏幕上绘制一条从点 (x1, y) 到点 (x2, y) 的直线，并返回绘制过后的数组。
    """
    # 初始化结果数组
    result = [0] * length
    
    # 计算起始和结束的整数索引
    start_index = (y * w + x1) // 32
    end_index = (y * w + x2) // 32
    
    # 设置起始整数
    if start_index == end_index:
        mask = ((1 << (x2 - x1 + 1)) - 1) << (31 - (x2 % 32))
        result[start_index] |= mask
    else:
        mask = (1 << (32 - (x1 % 32))) - 1
        result[start_index] |= mask
        for i in range(start_index + 1, end_index):
            result[i] = -1
        mask = (1 << (x2 % 32 + 1)) - 1
        result[end_index] |= mask
    
    return result


Solution = create_solution(draw_line)