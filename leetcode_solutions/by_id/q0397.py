# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 397
标题: Integer Replacement
难度: medium
链接: https://leetcode.cn/problems/integer-replacement/
题目类型: 贪心、位运算、记忆化搜索、动态规划
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
397. 整数替换 - 给定一个正整数 n ，你可以做如下操作： 1. 如果 n 是偶数，则用 n / 2替换 n 。 2. 如果 n 是奇数，则可以用 n + 1或n - 1替换 n 。 返回 n 变为 1 所需的 最小替换次数 。 示例 1： 输入：n = 8 输出：3 解释：8 -> 4 -> 2 -> 1 示例 2： 输入：n = 7 输出：4 解释：7 -> 8 -> 4 -> 2 -> 1 或 7 -> 6 -> 3 -> 2 -> 1 示例 3： 输入：n = 4 输出：2 提示： * 1 <= n <= 231 - 1
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 贪心 + 位运算：偶数一定除以 2；奇数时根据低位比特选择是加一还是减一，使得整体步数最少。

算法步骤:
1. 当 n 为偶数时，直接 n /= 2。
2. 当 n 为奇数时有两种选择 n+1 或 n-1：
   - 对于 n==3，选择 n-1 更优（3->2->1，共 2 步）。
   - 对于其他奇数，若 `(n & 2) == 0`（次低位为 0），则 n-1；否则 n+1，这样能尽量得到更多连续的 0 便于后续多次右移。
3. 每进行一次操作步数加一，直至 n 变为 1。

关键点:
- 通过观察二进制形式选择更有利于快速变小的方向。
- 特判 n==3 避免走到 4 再除以 2 的冗余步骤。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(log n)，每次操作至少会减少一位有效二进制长度。
空间复杂度: O(1)。 
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List, Optional
from leetcode_solutions.utils.linked_list import ListNode
from leetcode_solutions.utils.tree import TreeNode
from leetcode_solutions.utils.solution import create_solution


def integer_replacement(n: int) -> int:
    """
    将正整数 n 通过 n/2 或 n±1 操作变为 1 的最小步数。

    使用贪心 + 位运算：奇数时优先选择让低位变为大量连续 0 的方向（除了 n=3 特例）。
    """
    steps = 0
    while n != 1:
        if n % 2 == 0:
            n //= 2
        else:
            if n == 3 or (n & 2) == 0:
                n -= 1
            else:
                n += 1
        steps += 1
    return steps


# 自动生成Solution类（无需手动编写）
Solution = create_solution(integer_replacement)
