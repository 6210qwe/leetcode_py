# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 3000
标题: Minimum Absolute Difference Between Elements With Constraint
难度: medium
链接: https://leetcode.cn/problems/minimum-absolute-difference-between-elements-with-constraint/
题目类型: 数组、二分查找、有序集合
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
2817. 限制条件下元素之间的最小绝对差 - 给你一个下标从 0 开始的整数数组 nums 和一个整数 x 。 请你找到数组中下标距离至少为 x 的两个元素的 差值绝对值 的 最小值 。 换言之，请你找到两个下标 i 和 j ，满足 abs(i - j) >= x 且 abs(nums[i] - nums[j]) 的值最小。 请你返回一个整数，表示下标距离至少为 x 的两个元素之间的差值绝对值的 最小值 。 示例 1： 输入：nums = [4,3,2,4], x = 2 输出：0 解释：我们选择 nums[0] = 4 和 nums[3] = 4 。 它们下标距离满足至少为 2 ，差值绝对值为最小值 0 。 0 是最优解。 示例 2： 输入：nums = [5,3,2,10,15], x = 1 输出：1 解释：我们选择 nums[1] = 3 和 nums[2] = 2 。 它们下标距离满足至少为 1 ，差值绝对值为最小值 1 。 1 是最优解。 示例 3： 输入：nums = [1,2,3,4], x = 3 输出：3 解释：我们选择 nums[0] = 1 和 nums[3] = 4 。 它们下标距离满足至少为 3 ，差值绝对值为最小值 3 。 3 是最优解。 提示： * 1 <= nums.length <= 105 * 1 <= nums[i] <= 109 * 0 <= x < nums.length
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用有序集合（SortedList）来维护一个滑动窗口，窗口大小为 x，以确保下标距离至少为 x。对于每个元素，我们在有序集合中查找与其最接近的元素，计算差值绝对值，并更新最小差值。

算法步骤:
1. 初始化一个有序集合 `sl` 和一个变量 `min_diff` 用于存储最小差值。
2. 遍历数组 `nums`，对于每个元素 `nums[i]`：
   - 如果 `i >= x`，将 `nums[i-x]` 添加到有序集合 `sl` 中。
   - 在有序集合 `sl` 中查找与 `nums[i]` 最接近的元素，计算差值绝对值，并更新 `min_diff`。
3. 返回 `min_diff`。

关键点:
- 使用 `SortedList` 来维护滑动窗口，确保下标距离至少为 x。
- 使用二分查找在有序集合中查找最接近的元素。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n log n)，其中 n 是数组 `nums` 的长度。每次插入和查找操作的时间复杂度为 O(log n)。
空间复杂度: O(n)，有序集合 `sl` 的最大大小为 n。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List
from sortedcontainers import SortedList

def min_absolute_difference(nums: List[int], x: int) -> int:
    """
    返回下标距离至少为 x 的两个元素之间的差值绝对值的最小值。
    """
    sl = SortedList()
    min_diff = float('inf')
    
    for i in range(len(nums)):
        if i >= x:
            sl.add(nums[i - x])
        
        if sl:
            idx = sl.bisect_left(nums[i])
            if idx < len(sl):
                min_diff = min(min_diff, abs(nums[i] - sl[idx]))
            if idx > 0:
                min_diff = min(min_diff, abs(nums[i] - sl[idx - 1]))
    
    return min_diff

Solution = create_solution(min_absolute_difference)