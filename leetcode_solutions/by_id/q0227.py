# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 227
标题: Basic Calculator II
难度: medium
链接: https://leetcode.cn/problems/basic-calculator-ii/
题目类型: 栈、数学、字符串
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
227. 基本计算器 II - 给你一个字符串表达式 s ，请你实现一个基本计算器来计算并返回它的值。 整数除法仅保留整数部分。 你可以假设给定的表达式总是有效的。所有中间结果将在 [-231, 231 - 1] 的范围内。 注意：不允许使用任何将字符串作为数学表达式计算的内置函数，比如 eval() 。 示例 1： 输入：s = "3+2*2" 输出：7 示例 2： 输入：s = " 3/2 " 输出：1 示例 3： 输入：s = " 3+5 / 2 " 输出：5 提示： * 1 <= s.length <= 3 * 105 * s 由整数和算符 ('+', '-', '*', '/') 组成，中间由一些空格隔开 * s 表示一个 有效表达式 * 表达式中的所有整数都是非负整数，且在范围 [0, 231 - 1] 内 * 题目数据保证答案是一个 32-bit 整数
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用栈处理乘除运算，先计算乘除，再计算加减

算法步骤:
1. 遍历字符串，遇到数字时读取完整数字
2. 遇到'+'或'-'时，将当前数字（带符号）入栈
3. 遇到'*'或'/'时，立即计算并更新栈顶元素
4. 最后将栈中所有元素相加

关键点:
- 使用栈处理运算优先级
- 时间复杂度O(n)，空间复杂度O(n)
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n) - 需要遍历字符串一次
空间复杂度: O(n) - 栈的空间
"""

# ============================================================================
# 代码实现
# ============================================================================

from leetcode_solutions.utils.solution import create_solution


def basic_calculator_ii(s: str) -> int:
    """
    函数式接口 - 基本计算器II
    
    实现思路:
    使用栈处理乘除运算，先计算乘除，再计算加减。
    
    Args:
        s: 字符串表达式
        
    Returns:
        计算结果
        
    Example:
        >>> basic_calculator_ii("3+2*2")
        7
    """
    stack = []
    num = 0
    sign = '+'
    i = 0
    
    while i < len(s):
        char = s[i]
        
        if char.isdigit():
            # 读取完整数字
            num = 0
            while i < len(s) and s[i].isdigit():
                num = num * 10 + int(s[i])
                i += 1
            i -= 1
        
        if (char != ' ' and not char.isdigit()) or i == len(s) - 1:
            if sign == '+':
                stack.append(num)
            elif sign == '-':
                stack.append(-num)
            elif sign == '*':
                stack[-1] *= num
            elif sign == '/':
                stack[-1] = int(stack[-1] / num)  # 整数除法
            
            sign = char
            num = 0
        
        i += 1
    
    return sum(stack)


# 自动生成Solution类（无需手动编写）
Solution = create_solution(basic_calculator_ii)
