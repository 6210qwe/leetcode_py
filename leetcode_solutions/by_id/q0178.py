# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 178
标题: Rank Scores
难度: medium
链接: https://leetcode.cn/problems/rank-scores/
题目类型: 数据库
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
178. 分数排名 - 表: Scores +-------------+---------+ | Column Name | Type | +-------------+---------+ | id | int | | score | decimal | +-------------+---------+ id 是该表的主键（有不同值的列）。 该表的每一行都包含了一场比赛的分数。Score 是一个有两位小数点的浮点值。 编写一个解决方案来查询分数的排名。排名按以下规则计算: * 分数应按从高到低排列。 * 如果两个分数相等，那么两个分数的排名应该相同。 * 在排名相同的分数后，排名数应该是下一个连续的整数。换句话说，排名之间不应该有空缺的数字。 按 score 降序返回结果表。 查询结果格式如下所示。 示例 1: 输入: Scores 表: +----+-------+ | id | score | +----+-------+ | 1 | 3.50 | | 2 | 3.65 | | 3 | 4.00 | | 4 | 3.85 | | 5 | 4.00 | | 6 | 3.65 | +----+-------+ 输出: +-------+------+ | score | rank | +-------+------+ | 4.00 | 1 | | 4.00 | 1 | | 3.85 | 2 | | 3.65 | 3 | | 3.65 | 3 | | 3.50 | 4 | +-------+------+
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: SQL窗口函数DENSE_RANK()计算排名

算法步骤:
1. 使用DENSE_RANK()窗口函数
2. 按score降序排序
3. 相同分数排名相同，且排名连续

关键点:
- 使用DENSE_RANK()窗口函数
- SQL查询语句
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(nlogn) - 排序的时间复杂度
空间复杂度: O(n) - 窗口函数需要存储排序结果
"""

# ============================================================================
# 代码实现
# ============================================================================

from leetcode_solutions.utils.solution import create_solution


def rank_scores():
    """
    函数式接口 - 分数排名（SQL查询）
    
    实现思路:
    使用DENSE_RANK()窗口函数计算排名。
    
    Returns:
        SQL查询语句字符串
        
    Example:
        >>> sql = rank_scores()
        >>> # 执行SQL查询
    """
    sql = """
    SELECT 
        score,
        DENSE_RANK() OVER (ORDER BY score DESC) AS 'rank'
    FROM Scores
    ORDER BY score DESC
    """
    return sql.strip()


# 自动生成Solution类（无需手动编写）
Solution = create_solution(rank_scores)
