# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 100336
标题: 望远镜中最高的海拔
难度: hard
链接: https://leetcode.cn/problems/hua-dong-chuang-kou-de-zui-da-zhi-lcof/
题目类型: 队列、数组、滑动窗口、单调队列、堆（优先队列）
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
LCR 183. 望远镜中最高的海拔 - 科技馆内有一台虚拟观景望远镜，它可以用来观测特定纬度地区的地形情况。该纬度的海拔数据记于数组 heights ，其中 heights[i] 表示对应位置的海拔高度。请找出并返回望远镜视野范围 limit 内，可以观测到的最高海拔值。 示例 1： 输入：heights = [14,2,27,-5,28,13,39], limit = 3 输出：[27,27,28,28,39] 解释： 滑动窗口的位置 最大值 --------------- ----- [14 2 27] -5 28 13 39 27 14 [2 27 -5] 28 13 39 27 14 2 [27 -5 28] 13 39 28 14 2 27 [-5 28 13] 39 28 14 2 27 -5 [28 13 39] 39 提示： 你可以假设输入总是有效的，在输入数组不为空的情况下： * 1 <= limit <= heights.length * -10000 <= heights[i] <= 10000 注意：本题与主站 239 题相同：https://leetcode.cn/problems/sliding-window-maximum/ [https://leetcode.cn/problems/sliding-window-maximum/]
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用单调队列来维护滑动窗口内的最大值。

算法步骤:
1. 初始化一个双端队列 `deque` 来存储当前窗口内的元素索引。
2. 遍历数组 `heights`，对于每个元素：
   - 移除 `deque` 中所有不在当前窗口范围内的索引。
   - 移除 `deque` 中所有小于当前元素的索引，以保持 `deque` 的单调性。
   - 将当前元素的索引加入 `deque`。
   - 如果当前索引大于等于 `limit - 1`，则将 `deque` 的第一个元素对应的值加入结果列表。
3. 返回结果列表。

关键点:
- 使用双端队列来维护一个单调递减的队列。
- 在每次移动窗口时，移除不在窗口范围内的元素。
- 保证队列头部始终是当前窗口的最大值。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)，其中 n 是数组 `heights` 的长度。每个元素最多被插入和删除一次。
空间复杂度: O(limit)，双端队列的最大长度为 `limit`。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List
from collections import deque

def max_sliding_window(heights: List[int], limit: int) -> List[int]:
    """
    函数式接口 - 返回滑动窗口内的最大值
    """
    if not heights or limit <= 0:
        return []

    n = len(heights)
    if n < limit:
        return [max(heights)]

    result = []
    deque = deque()

    for i in range(n):
        # 移除不在当前窗口范围内的索引
        if deque and deque[0] < i - limit + 1:
            deque.popleft()
        
        # 移除所有小于当前元素的索引
        while deque and heights[deque[-1]] < heights[i]:
            deque.pop()
        
        # 将当前元素的索引加入队列
        deque.append(i)
        
        # 如果当前索引大于等于 limit - 1，则将队列头部的值加入结果列表
        if i >= limit - 1:
            result.append(heights[deque[0]])

    return result

Solution = create_solution(max_sliding_window)