# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 659
标题: Split Array into Consecutive Subsequences
难度: medium
链接: https://leetcode.cn/problems/split-array-into-consecutive-subsequences/
题目类型: 贪心、数组、哈希表、堆（优先队列）
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
659. 分割数组为连续子序列 - 给你一个按 非递减顺序 排列的整数数组 nums 。 请你判断是否能在将 nums 分割成 一个或多个子序列 的同时满足下述 两个 条件： * 每个子序列都是一个 连续递增序列（即，每个整数 恰好 比前一个整数大 1 ）。 * 所有子序列的长度 至少 为 3 。 如果可以分割 nums 并满足上述条件，则返回 true ；否则，返回 false 。 示例 1： 输入：nums = [1,2,3,3,4,5] 输出：true 解释：nums 可以分割成以下子序列： [1,2,3,3,4,5] --> 1, 2, 3 [1,2,3,3,4,5] --> 3, 4, 5 示例 2： 输入：nums = [1,2,3,3,4,4,5,5] 输出：true 解释：nums 可以分割成以下子序列： [1,2,3,3,4,4,5,5] --> 1, 2, 3, 4, 5 [1,2,3,3,4,4,5,5] --> 3, 4, 5 示例 3： 输入：nums = [1,2,3,4,4,5] 输出：false 解释：无法将 nums 分割成长度至少为 3 的连续递增子序列。 提示： * 1 <= nums.length <= 104 * -1000 <= nums[i] <= 1000 * nums 按非递减顺序排列
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用贪心算法和哈希表来记录每个数字的出现次数和当前可以延长的子序列的尾部。

算法步骤:
1. 初始化两个哈希表：`count` 用于记录每个数字的剩余数量，`tails` 用于记录当前可以延长的子序列的尾部。
2. 遍历数组 `nums`：
   - 更新 `count` 中当前数字的数量。
   - 如果当前数字可以延长现有的子序列（即 `tails` 中存在当前数字减一），则更新 `tails`。
   - 否则，检查当前数字是否可以作为新的子序列的开始，并且后续的两个数字是否存在。
3. 最后检查 `tails` 中是否存在长度小于 3 的子序列。

关键点:
- 使用哈希表 `count` 和 `tails` 来高效地管理和扩展子序列。
- 确保每个子序列的长度至少为 3。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)，其中 n 是数组 `nums` 的长度。我们只需要遍历数组一次。
空间复杂度: O(n)，哈希表 `count` 和 `tails` 在最坏情况下需要存储所有元素。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List

def is_possible(nums: List[int]) -> bool:
    """
    判断是否可以将数组分割成一个或多个长度至少为 3 的连续递增子序列。
    """
    count = {}
    tails = {}

    for num in nums:
        count[num] = count.get(num, 0) + 1

    for num in nums:
        if count[num] == 0:
            continue
        count[num] -= 1

        if tails.get(num - 1, 0) > 0:
            tails[num - 1] -= 1
            tails[num] = tails.get(num, 0) + 1
        elif count.get(num + 1, 0) > 0 and count.get(num + 2, 0) > 0:
            count[num + 1] -= 1
            count[num + 2] -= 1
            tails[num + 2] = tails.get(num + 2, 0) + 1
        else:
            return False

    return True

Solution = create_solution(is_possible)