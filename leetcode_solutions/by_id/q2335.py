# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 2335
标题: Finding the Topic of Each Post
难度: hard
链接: https://leetcode.cn/problems/finding-the-topic-of-each-post/
题目类型: 数据库
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
2199. 找到每篇文章的主题 - 备战技术面试？力扣提供海量技术面试资源，帮助你高效提升编程技能,轻松拿下世界 IT 名企 Dream Offer。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用 SQL 查询来找到每篇文章的主题。

算法步骤:
1. 创建一个临时表，将 `Topics` 表中的 `topic_id` 和 `topic_name` 与 `Keywords` 表中的 `keyword` 进行连接。
2. 使用 `Posts` 表中的 `content` 字段进行全文搜索，匹配 `Keywords` 表中的 `keyword`。
3. 将匹配到的关键词和对应的文章进行关联，最终得到每篇文章的主题。

关键点:
- 使用全文搜索来匹配关键词。
- 使用临时表来存储中间结果，提高查询效率。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n * m)，其中 n 是文章的数量，m 是关键词的数量。
空间复杂度: O(k)，其中 k 是临时表的大小。
"""

# ============================================================================
# 代码实现
# ============================================================================

def solution_function_name():
    """
    函数式接口 - 实现 SQL 查询
    """
    query = """
    WITH Keywords AS (
        SELECT t.topic_id, t.topic_name, k.keyword
        FROM Topics t
        JOIN Keywords k ON t.topic_id = k.topic_id
    ),
    MatchedPosts AS (
        SELECT p.post_id, p.content, k.topic_id, k.topic_name
        FROM Posts p
        JOIN Keywords k ON p.content LIKE CONCAT('%', k.keyword, '%')
    )
    SELECT post_id, topic_name
    FROM MatchedPosts
    GROUP BY post_id, topic_name;
    """
    return query

Solution = create_solution(solution_function_name)