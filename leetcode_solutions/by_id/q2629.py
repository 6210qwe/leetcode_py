# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 2629
标题: Number of Substrings With Fixed Ratio
难度: medium
链接: https://leetcode.cn/problems/number-of-substrings-with-fixed-ratio/
题目类型: 哈希表、数学、字符串、前缀和
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
2489. 固定比率的子字符串数 - 备战技术面试？力扣提供海量技术面试资源，帮助你高效提升编程技能,轻松拿下世界 IT 名企 Dream Offer。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用前缀和来计算满足固定比率的子字符串数。

算法步骤:
1. 初始化前缀和数组 `prefix`，用于记录到当前位置为止的字符 'a' 和 'b' 的数量差。
2. 遍历字符串，更新前缀和数组。
3. 使用哈希表 `count` 记录每个前缀和出现的次数。
4. 对于每个位置，计算当前前缀和与目标比率的差值，并在哈希表中查找该差值出现的次数，累加到结果中。
5. 更新哈希表中当前前缀和的计数。

关键点:
- 使用前缀和数组和哈希表来高效计算满足条件的子字符串数。
- 通过差值来判断是否满足固定比率。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)，其中 n 是字符串的长度。我们只需要遍历字符串一次。
空间复杂度: O(n)，哈希表 `count` 在最坏情况下需要存储 n 个不同的前缀和。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List, Optional
from leetcode_solutions.utils.linked_list import ListNode
from leetcode_solutions.utils.tree import TreeNode
from leetcode_solutions.utils.solution import create_solution


def number_of_substrings_with_fixed_ratio(s: str, a: int, b: int) -> int:
    """
    计算满足固定比率的子字符串数。
    :param s: 输入字符串
    :param a: 字符 'a' 的期望数量
    :param b: 字符 'b' 的期望数量
    :return: 满足固定比率的子字符串数
    """
    n = len(s)
    prefix = 0
    count = {0: 1}
    result = 0
    
    for i in range(n):
        if s[i] == 'a':
            prefix += 1
        else:
            prefix -= 1
        
        # 计算当前前缀和与目标比率的差值
        diff = prefix - (a - b)
        
        # 累加满足条件的子字符串数
        result += count.get(diff, 0)
        
        # 更新哈希表中当前前缀和的计数
        count[prefix] = count.get(prefix, 0) + 1
    
    return result


Solution = create_solution(number_of_substrings_with_fixed_ratio)