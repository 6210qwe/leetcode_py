# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 3521
标题: Count Triplets with Even XOR Set Bits II
难度: medium
链接: https://leetcode.cn/problems/count-triplets-with-even-xor-set-bits-ii/
题目类型: 位运算、数组
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
3215. 用偶数异或设置位计数三元组 II - 备战技术面试？力扣提供海量技术面试资源，帮助你高效提升编程技能,轻松拿下世界 IT 名企 Dream Offer。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 利用位运算和前缀异或的性质来计算满足条件的三元组数量。

算法步骤:
1. 计算前缀异或数组。
2. 使用哈希表记录每个前缀异或值出现的次数。
3. 遍历前缀异或数组，对于每个前缀异或值，计算其与之前所有前缀异或值的异或结果为偶数的情况数。

关键点:
- 前缀异或数组可以帮助快速计算任意子数组的异或值。
- 使用哈希表记录前缀异或值的频率，以便快速查找。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)
空间复杂度: O(n)
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List
from collections import defaultdict

def count_triplets(nums: List[int]) -> int:
    """
    函数式接口 - 计算满足条件的三元组数量
    """
    n = len(nums)
    prefix_xor = [0] * (n + 1)
    for i in range(n):
        prefix_xor[i + 1] = prefix_xor[i] ^ nums[i]
    
    count = 0
    freq = defaultdict(int)
    
    for i in range(1, n + 1):
        for j in range(i):
            if (prefix_xor[i] ^ prefix_xor[j]) % 2 == 0:
                count += freq[prefix_xor[j]]
        freq[prefix_xor[i]] += 1
    
    return count

Solution = create_solution(count_triplets)