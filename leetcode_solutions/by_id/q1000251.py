# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 1000251
标题: 找到字符串中所有字母异位词
难度: medium
链接: https://leetcode.cn/problems/VabMRr/
题目类型: 哈希表、字符串、滑动窗口
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
LCR 015. 找到字符串中所有字母异位词 - 给定两个字符串 s 和 p，找到 s 中所有 p 的 变位词 的子串，返回这些子串的起始索引。不考虑答案输出的顺序。 变位词 指字母相同，但排列不同的字符串。 示例 1： 输入: s = "cbaebabacd", p = "abc" 输出: [0,6] 解释: 起始索引等于 0 的子串是 "cba", 它是 "abc" 的变位词。 起始索引等于 6 的子串是 "bac", 它是 "abc" 的变位词。 示例 2： 输入: s = "abab", p = "ab" 输出: [0,1,2] 解释: 起始索引等于 0 的子串是 "ab", 它是 "ab" 的变位词。 起始索引等于 1 的子串是 "ba", 它是 "ab" 的变位词。 起始索引等于 2 的子串是 "ab", 它是 "ab" 的变位词。 提示： * 1 <= s.length, p.length <= 3 * 104 * s 和 p 仅包含小写字母 注意：本题与主站 438 题相同： https://leetcode.cn/problems/find-all-anagrams-in-a-string/ [https://leetcode.cn/problems/find-all-anagrams-in-a-string/]
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 滑动窗口 + 26 维计数

算法步骤:
1. 统计模式串 p 的字符频次 need[26]
2. 使用长度为 len(p) 的滑动窗口在 s 上滑动，维护 window[26]
3. 当窗口长度达到 len(p) 时，若 window == need，则当前窗口起点是一个变位词位置
4. 继续滑动直到遍历结束

关键点:
- 固定窗口长度为 len(p)
- 字符都为小写字母，用 26 个计数即可
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n) - n 为 s 长度（每步比较 26 常数）
空间复杂度: O(1)
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List, Optional
from leetcode_solutions.utils.linked_list import ListNode
from leetcode_solutions.utils.tree import TreeNode
from leetcode_solutions.utils.solution import create_solution


def find_anagrams(s: str, p: str) -> List[int]:
    """
    函数式接口 - 找到字符串中所有字母异位词
    """
    m, n = len(p), len(s)
    if m > n:
        return []

    need = [0] * 26
    window = [0] * 26
    for ch in p:
        need[ord(ch) - 97] += 1

    res: List[int] = []
    for i, ch in enumerate(s):
        window[ord(ch) - 97] += 1
        if i >= m:
            window[ord(s[i - m]) - 97] -= 1
        if i >= m - 1 and window == need:
            res.append(i - m + 1)
    return res


Solution = create_solution(find_anagrams)
