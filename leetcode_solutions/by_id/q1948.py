# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 1948
标题: Rearrange Products Table
难度: easy
链接: https://leetcode.cn/problems/rearrange-products-table/
题目类型: 数据库
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
1795. 每个产品在不同商店的价格 - 表：Products +-------------+---------+ | Column Name | Type | +-------------+---------+ | product_id | int | | store1 | int | | store2 | int | | store3 | int | +-------------+---------+ 在 SQL 中，这张表的主键是 product_id（产品Id）。 每行存储了这一产品在不同商店 store1, store2, store3 的价格。 如果这一产品在商店里没有出售，则值将为 null。 请你重构 Products 表，查询每个产品在不同商店的价格，使得输出的格式变为(product_id, store, price) 。如果这一产品在商店里没有出售，则不输出这一行。 输出结果表中的 顺序不作要求 。 查询输出格式请参考下面示例。 示例 1： 输入： Products table: +------------+--------+--------+--------+ | product_id | store1 | store2 | store3 | +------------+--------+--------+--------+ | 0 | 95 | 100 | 105 | | 1 | 70 | null | 80 | +------------+--------+--------+--------+ 输出： +------------+--------+-------+ | product_id | store | price | +------------+--------+-------+ | 0 | store1 | 95 | | 0 | store2 | 100 | | 0 | store3 | 105 | | 1 | store1 | 70 | | 1 | store3 | 80 | +------------+--------+-------+ 解释： 产品 0 在 store1、store2、store3 的价格分别为 95、100、105。 产品 1 在 store1、store3 的价格分别为 70、80。在 store2 无法买到。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用Pandas库来处理数据，并通过melt函数将宽表转换为长表。

算法步骤:
1. 读取输入的DataFrame。
2. 使用melt函数将宽表转换为长表，设置id_vars为'product_id'，value_vars为'store1', 'store2', 'store3'。
3. 删除价格为空的行。
4. 重命名列名，将'value'列重命名为'price'，将'variable'列重命名为'store'。

关键点:
- 使用Pandas的melt函数可以方便地将宽表转换为长表。
- 通过删除价格为空的行来过滤掉没有销售的产品。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n)，其中n是产品的数量。因为我们需要遍历每个产品和每个商店的价格。
空间复杂度: O(n)，因为我们需要存储转换后的DataFrame。
"""

# ============================================================================
# 代码实现
# ============================================================================

import pandas as pd

def rearrange_products_table(products: pd.DataFrame) -> pd.DataFrame:
    """
    重构Products表，查询每个产品在不同商店的价格，使得输出的格式变为(product_id, store, price)。
    如果这一产品在商店里没有出售，则不输出这一行。
    """
    # 使用melt函数将宽表转换为长表
    melted_df = products.melt(id_vars='product_id', value_vars=['store1', 'store2', 'store3'], 
                              var_name='store', value_name='price')
    
    # 删除价格为空的行
    filtered_df = melted_df.dropna(subset=['price'])
    
    return filtered_df

Solution = create_solution(rearrange_products_table)