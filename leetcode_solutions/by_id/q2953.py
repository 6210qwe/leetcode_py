# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 2953
标题: Count Pairs of Points With Distance k
难度: medium
链接: https://leetcode.cn/problems/count-pairs-of-points-with-distance-k/
题目类型: 位运算、数组、哈希表
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
2857. 统计距离为 k 的点对 - 给你一个 二维 整数数组 coordinates 和一个整数 k ，其中 coordinates[i] = [xi, yi] 是第 i 个点在二维平面里的坐标。 我们定义两个点 (x1, y1) 和 (x2, y2) 的 距离 为 (x1 XOR x2) + (y1 XOR y2) ，XOR 指的是按位异或运算。 请你返回满足 i < j 且点 i 和点 j之间距离为 k 的点对数目。 示例 1： 输入：coordinates = [[1,2],[4,2],[1,3],[5,2]], k = 5 输出：2 解释：以下点对距离为 k ： - (0, 1)：(1 XOR 4) + (2 XOR 2) = 5 。 - (2, 3)：(1 XOR 5) + (3 XOR 2) = 5 。 示例 2： 输入：coordinates = [[1,3],[1,3],[1,3],[1,3],[1,3]], k = 0 输出：10 解释：任何两个点之间的距离都为 0 ，所以总共有 10 组点对。 提示： * 2 <= coordinates.length <= 50000 * 0 <= xi, yi <= 106 * 0 <= k <= 100
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用哈希表记录每个点的出现次数，然后遍历每个点，计算其与目标距离 k 的所有可能的点，并检查这些点是否在哈希表中。

算法步骤:
1. 初始化一个哈希表 `count` 来记录每个点的出现次数。
2. 遍历 `coordinates` 数组，对于每个点 `(x, y)`，计算其与目标距离 k 的所有可能的点 `(x1, y1)`，并检查这些点是否在哈希表中。
3. 如果存在这样的点 `(x1, y1)`，则将其对应的计数值加到结果中。
4. 更新哈希表 `count`，将当前点 `(x, y)` 的计数值加一。

关键点:
- 使用哈希表来记录每个点的出现次数，从而可以在 O(1) 时间内检查某个点是否存在。
- 通过遍历所有可能的 `(x1, y1)` 来计算距离，确保不会遗漏任何点对。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n * k)，其中 n 是 coordinates 的长度，k 是给定的距离。因为我们需要遍历每个点，并对其最多 k 个可能的点进行检查。
空间复杂度: O(n)，因为我们使用了一个哈希表来存储每个点的出现次数。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List
from collections import defaultdict

def count_pairs(coordinates: List[List[int]], k: int) -> int:
    """
    函数式接口 - 统计距离为 k 的点对数目
    """
    count = defaultdict(int)
    result = 0
    
    for x, y in coordinates:
        for dk in range(k + 1):
            x1 = x ^ dk
            y1 = y ^ (k - dk)
            if (x1, y1) in count:
                result += count[(x1, y1)]
        count[(x, y)] += 1
    
    return result

Solution = create_solution(count_pairs)