# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 2522
标题: Median of a Row Wise Sorted Matrix
难度: medium
链接: https://leetcode.cn/problems/median-of-a-row-wise-sorted-matrix/
题目类型: 数组、二分查找、矩阵
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
2387. 行排序矩阵的中位数 - 备战技术面试？力扣提供海量技术面试资源，帮助你高效提升编程技能,轻松拿下世界 IT 名企 Dream Offer。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用二分查找来找到矩阵中的中位数。

算法步骤:
1. 初始化二分查找的左右边界，left 为矩阵中的最小值，right 为矩阵中的最大值。
2. 在每次迭代中，计算中间值 mid，并统计矩阵中小于等于 mid 的元素个数 count。
3. 如果 count 小于 (m * n) // 2 + 1，则说明中位数在 mid 的右边，更新 left 为 mid + 1。
4. 否则，更新 right 为 mid。
5. 最终 left 即为矩阵的中位数。

关键点:
- 使用二分查找来缩小搜索范围，确保时间复杂度最优。
- 统计小于等于 mid 的元素个数时，利用行排序的特性，可以使用二分查找加速。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(m log(max-min) log n)，其中 m 是矩阵的行数，n 是列数，max 和 min 分别是矩阵中的最大值和最小值。
空间复杂度: O(1)，只使用了常数级的额外空间。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List

def solution_function_name(matrix: List[List[int]]) -> int:
    """
    函数式接口 - 找到行排序矩阵的中位数
    """
    def count_le_mid(mid: int) -> int:
        """统计矩阵中小于等于 mid 的元素个数"""
        count = 0
        for row in matrix:
            count += bisect_right(row, mid)
        return count

    m, n = len(matrix), len(matrix[0])
    left, right = matrix[0][0], matrix[-1][-1]
    
    while left < right:
        mid = (left + right) // 2
        if count_le_mid(mid) < (m * n) // 2 + 1:
            left = mid + 1
        else:
            right = mid
    
    return left

Solution = create_solution(solution_function_name)