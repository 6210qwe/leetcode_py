# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 185
标题: Department Top Three Salaries
难度: hard
链接: https://leetcode.cn/problems/department-top-three-salaries/
题目类型: 数据库
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
185. 部门工资前三高的所有员工 - 表: Employee +--------------+---------+ | Column Name | Type | +--------------+---------+ | id | int | | name | varchar | | salary | int | | departmentId | int | +--------------+---------+ id 是该表的主键列(具有唯一值的列)。 departmentId 是 Department 表中 ID 的外键（reference 列）。 该表的每一行都表示员工的ID、姓名和工资。它还包含了他们部门的ID。 表: Department +-------------+---------+ | Column Name | Type | +-------------+---------+ | id | int | | name | varchar | +-------------+---------+ id 是该表的主键列(具有唯一值的列)。 该表的每一行表示部门ID和部门名。 公司的主管们感兴趣的是公司每个部门中谁赚的钱最多。一个部门的 高收入者 是指一个员工的工资在该部门的 不同 工资中 排名前三 。 编写解决方案，找出每个部门中 收入高的员工 。 以 任意顺序 返回结果表。 返回结果格式如下所示。 示例 1: 输入: Employee 表: +----+-------+--------+--------------+ | id | name | salary | departmentId | +----+-------+--------+--------------+ | 1 | Joe | 85000 | 1 | | 2 | Henry | 80000 | 2 | | 3 | Sam | 60000 | 2 | | 4 | Max | 90000 | 1 | | 5 | Janet | 69000 | 1 | | 6 | Randy | 85000 | 1 | | 7 | Will | 70000 | 1 | +----+-------+--------+--------------+ Department 表: +----+-------+ | id | name | +----+-------+ | 1 | IT | | 2 | Sales | +----+-------+ 输出: +------------+----------+--------+ | Department | Employee | Salary | +------------+----------+--------+ | IT | Max | 90000 | | IT | Joe | 85000 | | IT | Randy | 85000 | | IT | Will | 70000 | | Sales | Henry | 80000 | | Sales | Sam | 60000 | +------------+----------+--------+ 解释: 在IT部门: - Max的工资最高 - 兰迪和乔都赚取第二高的独特的薪水 - 威尔的薪水是第三高的 在销售部: - 亨利的工资最高 - 山姆的薪水第二高 - 没有第三高的工资，因为只有两名员工 提示： * 没有姓名、薪资和部门 完全 相同的员工。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: SQL窗口函数DENSE_RANK()查找每个部门前三高的薪水

算法步骤:
1. 使用DENSE_RANK()窗口函数按部门分组，按薪水降序排名
2. 连接Employee和Department表
3. 筛选排名<=3的员工

关键点:
- 使用DENSE_RANK()窗口函数计算排名
- SQL查询语句
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(nlogn) - 排序的时间复杂度
空间复杂度: O(n) - 窗口函数结果的空间
"""

# ============================================================================
# 代码实现
# ============================================================================

from leetcode_solutions.utils.solution import create_solution


def department_top_three_salaries():
    """
    函数式接口 - 部门工资前三高的所有员工（SQL查询）
    
    实现思路:
    使用DENSE_RANK()窗口函数查找每个部门前三高的薪水。
    
    Returns:
        SQL查询语句字符串
        
    Example:
        >>> sql = department_top_three_salaries()
        >>> # 执行SQL查询
    """
    sql = """
    SELECT d.name AS Department, e.name AS Employee, e.salary AS Salary
    FROM (
        SELECT 
            id, name, salary, departmentId,
            DENSE_RANK() OVER (PARTITION BY departmentId ORDER BY salary DESC) AS rk
        FROM Employee
    ) e
    JOIN Department d ON e.departmentId = d.id
    WHERE e.rk <= 3
    """
    return sql.strip()


# 自动生成Solution类（无需手动编写）
Solution = create_solution(department_top_three_salaries)
