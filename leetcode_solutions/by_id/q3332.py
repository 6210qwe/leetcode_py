# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 3332
标题: Minimum Operations to Exceed Threshold Value II
难度: medium
链接: https://leetcode.cn/problems/minimum-operations-to-exceed-threshold-value-ii/
题目类型: 数组、模拟、堆（优先队列）
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
3066. 超过阈值的最少操作数 II - 给你一个下标从 0 开始的整数数组 nums 和一个整数 k 。 你可以对 nums 执行一些操作，在一次操作中，你可以： * 选择 nums 中 最小 的两个整数 x 和 y 。 * 将 x 和 y 从 nums 中删除。 * 将 min(x, y) * 2 + max(x, y) 添加到数组中的任意位置。 注意，只有当 nums 至少 包含两个元素时，你才可以执行以上操作。 你需要使数组中的所有元素都 大于或等于 k ，请你返回需要的 最少 操作次数。 示例 1： 输入：nums = [2,11,10,1,3], k = 10 输出：2 解释： 1. 第一次操作中，我们删除元素 1 和 2 ，然后添加 1 * 2 + 2 到 nums 中，nums 变为 [4, 11, 10, 3] 。 2. 第二次操作中，我们删除元素 3 和 4 ，然后添加 3 * 2 + 4 到 nums 中，nums 变为 [10, 11, 10] 。 此时，数组中的所有元素都大于等于 10 ，所以我们停止操作。 可以证明使数组中所有元素都大于等于 10 需要的最少操作次数为 2 。 示例 2： 输入：nums = [1,1,2,4,9], k = 20 输出：4 解释： 1. 第一次操作后，nums 变为 [2, 4, 9, 3]。 2. 第二次操作后，nums 变为 [7, 4, 9]。 3. 第三次操作后，nums 变为 [15, 9]。 4. 第四次操作后，nums 变为 [33]。 此时，nums 中的所有元素都大于等于 20 ，所以我们停止操作。 可以证明使数组中所有元素都大于等于 20 需要的最少操作次数为 4 。 提示： * 2 <= nums.length <= 2 * 105 * 1 <= nums[i] <= 109 * 1 <= k <= 109 * 输入保证答案一定存在，也就是说，在进行某些次数的操作后，数组中所有元素都大于等于 k 。
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: 使用最小堆来维护当前数组中的最小元素，并在每次操作中取出最小的两个元素，计算新的元素并将其重新插入堆中。

算法步骤:
1. 初始化一个最小堆，并将数组中的所有元素加入堆中。
2. 初始化操作次数为 0。
3. 当堆中最小的元素小于 k 时，执行以下操作：
   - 从堆中取出最小的两个元素 x 和 y。
   - 计算新的元素 z = min(x, y) * 2 + max(x, y)。
   - 将 z 重新插入堆中。
   - 增加操作次数。
4. 返回操作次数。

关键点:
- 使用最小堆来高效地获取和更新最小元素。
- 每次操作后，堆会自动调整以保持最小堆的性质。
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(n log n)，其中 n 是数组的长度。每次操作的时间复杂度是 O(log n)，总共最多需要 n 次操作。
空间复杂度: O(n)，使用了一个最小堆来存储数组中的元素。
"""

# ============================================================================
# 代码实现
# ============================================================================

from typing import List
import heapq

def min_operations_to_exceed_threshold(nums: List[int], k: int) -> int:
    """
    函数式接口 - 返回使数组中所有元素都大于等于 k 的最少操作次数
    """
    # 初始化最小堆
    heap = []
    for num in nums:
        heapq.heappush(heap, num)
    
    operations = 0
    
    while heap[0] < k:
        # 取出最小的两个元素
        x = heapq.heappop(heap)
        y = heapq.heappop(heap)
        
        # 计算新的元素
        new_element = min(x, y) * 2 + max(x, y)
        
        # 将新元素插入堆中
        heapq.heappush(heap, new_element)
        
        # 增加操作次数
        operations += 1
    
    return operations

Solution = create_solution(min_operations_to_exceed_threshold)