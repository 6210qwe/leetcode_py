# -*- coding:utf-8 -*-
# ============================================================================
# 题目信息
# ============================================================================
"""
题号: 177
标题: Nth Highest Salary
难度: medium
链接: https://leetcode.cn/problems/nth-highest-salary/
题目类型: 数据库
"""

# ============================================================================
# 问题描述
# ============================================================================
"""
177. 第N高的薪水 - 表: Employee +-------------+------+ | Column Name | Type | +-------------+------+ | id | int | | salary | int | +-------------+------+ id 是该表的主键（列中的值互不相同）。 该表的每一行都包含有关员工工资的信息。 编写一个解决方案查询 Employee 表中第 n 高的 不同 工资。如果少于 n 个不同工资，查询结果应该为 null 。 查询结果格式如下所示。 示例 1: 输入: Employee table: +----+--------+ | id | salary | +----+--------+ | 1 | 100 | | 2 | 200 | | 3 | 300 | +----+--------+ n = 2 输出: +------------------------+ | getNthHighestSalary(2) | +------------------------+ | 200 | +------------------------+ 示例 2: 输入: Employee 表: +----+--------+ | id | salary | +----+--------+ | 1 | 100 | +----+--------+ n = 2 输出: +------------------------+ | getNthHighestSalary(2) | +------------------------+ | null | +------------------------+
"""

# ============================================================================
# 实现思路
# ============================================================================
"""
核心思想: SQL函数，使用DISTINCT和LIMIT获取第N高的薪水

算法步骤:
1. 创建函数，参数为N
2. 使用DISTINCT去重
3. 按salary降序排序
4. 使用LIMIT 1 OFFSET N-1获取第N高的记录

关键点:
- 使用函数封装查询逻辑
- SQL函数定义
"""

# ============================================================================
# 复杂度分析
# ============================================================================
"""
时间复杂度: O(nlogn) - 排序的时间复杂度
空间复杂度: O(1) - 只返回一条记录
"""

# ============================================================================
# 代码实现
# ============================================================================

from leetcode_solutions.utils.solution import create_solution


def nth_highest_salary():
    """
    函数式接口 - 查询第N高的薪水（SQL函数）
    
    实现思路:
    使用DISTINCT和LIMIT获取第N高的薪水。
    
    Returns:
        SQL函数定义字符串
        
    Example:
        >>> sql = nth_highest_salary()
        >>> # 执行SQL函数定义
    """
    sql = """
    CREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT
    BEGIN
        SET N = N - 1;
        RETURN (
            SELECT DISTINCT salary
            FROM Employee
            ORDER BY salary DESC
            LIMIT 1 OFFSET N
        );
    END
    """
    return sql.strip()


# 自动生成Solution类（无需手动编写）
Solution = create_solution(nth_highest_salary)
